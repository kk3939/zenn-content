---
title: "Redux Toolkitã‚’ã¾ã¨ã‚ã¦ã¿ãŸ"
emoji: "ğŸ‰"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react", "javascript", "redux", "reduxtoolkit"]
published: true
---

React hooksã‚‚ç´ æ™´ã‚‰ã—ã„ã§ã™ãŒã€æ§˜ã€…ãªé¢ã§é™ç•ŒãŒã‚ã‚‹ã®ã§çŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å°å…¥ã—ãŸæ–¹ãŒã„ã„ã¨æ€ã„ã¾ã™ã€‚ãã®ä¸­ã§ã¯ã‚„ã£ã±ã‚Šã¾ã ReduxãŒæœ€æœ‰åŠ›ãªé¸æŠè‚¢ã§ã—ã‚‡ã†ã€‚

ä»Šå›ã¯reduxã¨ä½µç”¨ã™ã‚‹Redux Toolkitã«ã¤ã„ã¦å‹‰å¼·ã—ãŸã®ã§ã€ä»Šå›ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚

## ã“ã®è¨˜äº‹ã®æ¦‚è¦
ã“ã®è¨˜äº‹ã¯ã€ŒReduxã®ç†è§£ã¯ã‚ã‚‹ãŒã€Redux Toolkitã¨ä½µç”¨ã—ãŸã“ã¨ãªã„ã€ã¨ã„ã†äººã«å‘ã‘ã¦ã€Redux Toolkitã‚’ä½¿ã†ãŸã‚ã«å¿…è¦ãªå…¨ä½“åƒã®ç†è§£ã‚’ã–ã£ã¨ã™ã‚‹ã¨ã„ã†ã®ãŒç›®çš„ã§ã™ã€‚~~è‡ªåˆ†ã®å‹‰å¼·ã®ãƒ­ã‚°æ®‹ã—ã‚‚ç›®çš„~~

## redux toolkitã®ãƒ¡ãƒªãƒƒãƒˆ

ä»¥ä¸‹documentã‹ã‚‰å¼•ç”¨ã—ãŸã‚‚ã®ã§ã™ã€‚

> The Redux Toolkit package is intended to be the standard way to write Redux logic. It was originally created to help address three common concerns about Redux:

> - "Configuring a Redux store is too complicated"
> - "I have to add a lot of packages to get Redux to do anything useful"
> - "Redux requires too much boilerplate cod

ã–ã£ãã‚Šè¦ç´„ã™ã‚‹ã¨
- Storeã®ç†è§£ã‚’ç°¡å˜ã«ã™ã‚‹
- ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãŸãã•ã‚“å…¥ã‚Œãšã«ã™ã‚€ã‚ˆã†ã«ã™ã‚‹
- å®šå‹ã®ç¹°ã‚Šè¿”ã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã‚’å‰Šæ¸›ã™ã‚‹

ã“ã®3ã¤ãŒRedux Toolkitã®ç›®çš„ã¨è¨€ãˆã‚‹ã§ã—ã‚‡ã†ã€‚ç¢ºã‹ã«Actionã«è«å¤§ãªswitchæ–‡ã‚’æ›¸ãã®ã¯ã¨ã¦ã‚‚ã‚ã‚“ã©ãã•ã„ã§ã™ã€‚

> These tools should be beneficial to all Redux users.

Reduxã‚’ä½¿ã†äººã«ã¨ã£ã¦ã€ã¨ã¦ã‚‚æœ‰ç›Šãªpackageã§ã™ã€‚

## install

ä»Šå›ã¯æ—¢å­˜ã®ã‚¢ãƒ—ãƒªã«é©ç”¨ã•ã›ã‚‹å ´åˆã®ã¿è¨€åŠã—ã¾ã™ã€‚

```
// npm
npm install @reduxjs/toolkit react-redux
// yarn
yarn add @reduxjs/toolkit react-redux
```

https://redux-toolkit.js.org/introduction/getting-started

## å®Ÿéš›ã®ä½¿ã„æ–¹
åŸºæœ¬çš„ã«ã¯sliceã¨asyncActionã€ãã—ã¦storeã‚’ä½œæˆã™ã‚Œã°OKã§ã™ã€‚
Reduxã§ã¯Actionã¨ReducerãŒåˆ†ã‹ã‚Œã¦ã„ãŸã¨æ€ã„ã¾ã™ãŒã€Toolkitã‚’ä½¿ã„Sliceã§ä¸€å…ƒåŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### slice
ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚å˜ç´”ã«userã®stateã‚’åˆæœŸå€¤ã«æˆ»ã—ã¾ã™ã€‚
[createSlice](https://redux-toolkit.js.org/api/createSlice)ã‚’ä½¿ã†ã“ã¨ã§sliceã¨ãã®å†…éƒ¨ã§reducerã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```javascript
import { createSlice, PayloadAction } from '@reduxjs/toolkit'

export type User = {
  id: string | null
  username: string | null
  password: string | null
}

export type UserState = {
  user: User
}

export type UpdateUserPayload = User
export type AddHistoryPayload = string

export const initialState: UserState = {
  user: {
    id: null,
    username: null,
    password: null,
  },
}

const userSlice = createSlice({
  name: 'user',
  initialState,
  reducers: {
    signOut() {
      return initialState
    },
  },
})

export default userSlice
```

https://redux-toolkit.js.org/api/createSlice

### store

å…ˆã»ã©ä½œæˆã—ãŸuserSliceã®reducerã‚’storeã®reducerã«è¨­å®šã—ã¦ãã ã•ã„ã€‚
åŠ ãˆã¦sliceã®æ•°ãŒè¤‡æ•°ã«ãªã£ãŸéš›ã¯[combineReducers](https://redux.js.org/api/combinereducers)ã§åˆä½“ã•ã›ãŸæ–¹ãŒè‰¯ã„ã§ã™ã€‚


```javascript
import { Store } from 'redux';
import logger from 'redux-logger';
import { configureStore, getDefaultMiddleware } from '@reduxjs/toolkit';
import userSlice, { initialState as userState } from './users/slice';

const preloadedState = () => {
  return userState;
};

export type StoreState = ReturnType<typeof preloadedState>;

export type ReduxStore = Store<StoreState>;

const middlewareList = [...getDefaultMiddleware(), logger];
const createStore = configureStore({
  reducer: userSlice.reducer,
  middleware: middlewareList,
  preloadedState: preloadedState(),
  devTools: true,
});


export default createStore;
```

middlewareãªã©ã®å¿…è¦ãªã‚‚ã®ã¯å„è‡ªã§è¨­å®šã—ã¦ä¸‹ã•ã„ã€‚

https://redux-toolkit.js.org/api/configureStore

### createAsyncThunk
createAsyncThunkã¯éåŒæœŸå‡¦ç†ã®reducerã¨æ‰ãˆã¦ãã ã•ã„ã€‚å…ˆã»ã©ã®sliceã«è¿½è¨˜ã—ã¾ã™ã€‚
ã¾ãŸã€é€šä¿¡ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆ`pending`,`fulfilled`,`rejected`ï¼‰ã”ã¨ã«å‡¦ç†ã‚’æ¡ä»¶åˆ†å²ã—ã¦è¨˜è¿°ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚


```javascript
import { createSlice, PayloadAction } from '@reduxjs/toolkit'
import { signIn,signUp } from './asyncAction'

export type User = {
  id?: string | null
  username: string | null
  password: string | null
}

export type UserState = {
  user: User
}

export type UpdateUserPayload = User
export type AddHistoryPayload = string

export const initialState: UserState = {
  user: {
    id: null,
    username: null,
    password: null,
  },
}

const userSlice = createSlice({
  name: 'user',
  initialState,
  reducers: {
    signOut() {
      return initialState
    },
  },
  // è¿½è¨˜------------------------------------
  extraReducers: (builder) => {
    // signUp
    builder.addCase(signUp.rejected,(state, action) => {
      console.log(action.error.message);
    });
    builder.addCase(signUp.fulfilled, (state, action: PayloadAction<UserState>) => {
      state.user = {
        id: action.payload.user.id,
        username: action.payload.user.username,
        password: action.payload.user.password
      }
    });
    // signIn
    builder.addCase(signIn.rejected,(state, action) => {
      console.log(action.error.message);
    });
    builder.addCase(signIn.fulfilled, (state, action: PayloadAction<UserState>) => {
      state.user = {
        id: action.payload.user.id,
        username: action.payload.user.username,
        password: action.payload.user.password
      }
    })
  }
  // ã“ã“ã¾ã§------------------------------------
})

export default userSlice
```

asyncActionãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã€ãã“ã«å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã—ãŸã€‚

ä»Šå›ã¯ã‚µãƒƒã¨è©¦ã™ãŸã‚ã«rails APIãƒ¢ãƒ¼ãƒ‰ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«ã—ã¦jsonã§ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚§ãƒƒãƒã—ã¦ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚ã¨ã‚Šã‚ãˆãšRedux Toolkitã®æŒ™å‹•ç¢ºèªã®ãŸã‚ã«ã‚µãƒƒã¨ã‚„ã£ãŸã®ã§ç´°ã‹ã„éƒ¨åˆ†ã®ã”æŒ‡æ‘˜ã¯é æ…®ãã ã•ã„ã€‚

```javascript
import { createAsyncThunk } from '@reduxjs/toolkit';
import { UserState } from './slice';

export const signIn = createAsyncThunk(
  'users/signIn',
  async (arg: UserState): Promise<UserState> => {
    const response = await fetch(
      "http://localhost:3000/users/signIn", {
      method: "POST",
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(arg)
    });
    const json = await response.json();
    // reducerã¸
    return {
      user: json
    };
  }
);

export const signUp = createAsyncThunk(
  'users/signUp',
  async (arg: UserState): Promise<UserState> => {
    const response = await fetch(
      "http://localhost:3000/users/signUp", {
      method: "POST",
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(arg)
    });
    const json = await response.json();
    // reducerã¸
    return {
      user: json
    };
  }
);
```

https://redux-toolkit.js.org/api/createAsyncThunk


### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰å‘¼ã³å‡ºã™ã«ã¯
ç”»é¢å´ã§ã¯é–¢æ•°ã‚’å®šç¾©ã—ã¦ã‚ã’ã¦ã€dispatchã§å‘¼ã³å‡ºã›ã°OK.

```javascript
const onclickSignIn = (params: UserState) => {
    dispatch(signIn(params));
}
```

å˜ç´”ã«å€¤ã‚’ä½¿ã„ãŸã„æ™‚ã‚‚`useSelector`ã‚’ä½¿ãˆã°OK.

```javascript
const user = useSelector((state: UserState) => state.user);
```

### Storeã‚’ãƒ©ãƒƒãƒ”ãƒ³ã‚°ã—ã¦ã‚ã’ã‚ˆã†ã€‚
ã‚‚ã¡ã‚ã‚“çŠ¶æ…‹ã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã§ç®¡ç†ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ä¸‹ã•ã„ã€‚
Provider ã¨ createStoreã‚’importã—ãŸä¸Šã§å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«æ¸¡ã›ã°OK.

```javascript
import { Provider } from 'react-redux';
import createStore from '../redux/createStore';
-----------------------------------------------

<Provider store={createStore}>
  <Component {...pageProps} />
</Provider>
```


## å‚è€ƒã«ã—ãŸã‚µã‚¤ãƒˆ
https://redux-toolkit.js.org/

https://zenn.dev/mayamashita/articles/12ab4a122a02cc

å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚