---
title: "recoilã‚’ç†è§£ã™ã‚‹"
emoji: "ğŸ¤–"
type: "tech"
topics: ["recoil", "React"]
published: false
---

ä»Šæ›´ãªãŒã‚‰recoilã‚’å‹‰å¼·ã—ãŸã®ã§ã€ãã®ã¾ã¨ã‚ã‚’æ›¸ãã¾ã™ã€‚
æ‰€æ„Ÿã¨ã—ã¦ã¯ã€reduxã‚ˆã‚Šã‚‚æ›¸ãã‚„ã™ãã€å­¦ç¿’ã‚³ã‚¹ãƒˆã‚‚ä½ã„ãªã¨æ„Ÿã˜ã¾ã—ãŸã€‚
åŸºæœ¬çš„ã«ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ãƒ™ãƒ¼ã‚¹ã«èª¬æ˜ã—ã¾ã™ã®ã§ã€ãã¡ã‚‰ã‚‚ä½µã›ã¦ç¢ºèªã—ã¦ãã ã•ã„ã€‚

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
å½“ãŸã‚Šå‰ã®ã€`yarn add recoil`ã€‚ã‚‚ã—ãã¯`npm install recoil`ã€‚
ãã®ä¸Šã§ã€RecoilRootã§å›²ã£ã¨ãã¾ã—ã‚‡ã†ã€‚

```tsx
import { RecoilRoot } from "recoil";

export const App: React.FC = () => {
  return (
    <RecoilRoot>
      <Component />
    </RecoilRoot>
  );
};
```

ã“ã‚Œã§RecoilRooté…ä¸‹ã§recoilãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## åŸºæœ¬æ¦‚å¿µ
### Atom
recoilã§ã¯**Atom**ã¨ã„ã†å˜ä½ãŒæœ€å°å˜ä½ã¨ãªã‚Šã¾ã™ã€‚
Atomã¯1ã¤ã®stateã‚’æ„å‘³ã—ã¾ã™ã€‚

```tsx
import { atom } from "recoil";

export const UserName = atom({
  key: "UserName",
  default: "",
});
```

ä¸Šè¨˜ã‚µãƒ³ãƒ—ãƒ«ã§ã¯ã€Userã®åå‰ã‚’æƒ³å®šã—ãŸatomã§ã™ã€‚
keyã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®æ–‡å­—åˆ—ã‚’è¨­å®šã—ã€defaultã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã—ã¾ã™ã€‚

### selector
selectorã«ã¯ã€stateã‚’æ›´æ–°ã—ãŸã‚ŠåŠ å·¥ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚

```tsx
const selector = selector<T>({
  key: "uniqueKey",
  get: ({ get }) => {
    // å¼•æ•°ã«atomã‚„selectorã‚’å…¥ã‚Œã¦ç¾åœ¨ã®stateã‚’å–å¾—ã€‚ãã®ä¸Šã§atomã‚’åˆ©ç”¨ã—ãŸãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ãã“ã¨ãŒã§ãã‚‹ã€‚
    get(atom);
  },
  set: ({ set }, newValue) => {
    // ç¬¬ä¸€å¼•æ•°ã«atomã‚’æŒ‡å®šã—ã€ç¬¬äºŒå¼•æ•°ã«å‘¼ã³å‡ºã—å´ã§å…¥åŠ›ã—ãŸå€¤ãŒå…¥ã‚‹ã€‚
    set(atom, newValue);
  }
});
```

ãã®ä»–è¨­å®šå¯èƒ½ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã‚ã‚‹ã®ã§ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
https://recoiljs.org/docs/api-reference/core/selector


## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰å‘¼ã³å‡ºã™æ–¹æ³•
ä»¥ä¸‹ã®ä¸‰ã¤ãŒã‚ã‚Šã¾ã™ã€‚
åŸºæœ¬çš„ã«ã¯åå‰ã‹ã‚‰æƒ³åƒã§ãã‚‹é€šã‚Šã§ã™ã€‚

- useRecoilState
- useRecoilValue
- useSetRecoilState

useRecoilStateã¯useStateã¨ã»ã¼åŒã˜ã§ã™ã€‚
å¼•æ•°ã«atomã‚„selectorãªã©ã®RecoilStateã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã€stateã¨setStateã‚’å¾—ã¾ã™ã€‚

```tsx
const age = atom({
  key: "age",
  default: 0
})

const Component = () => {
  const [age, setAgeState] = useRecoilState(age);
  return <p>{age}æ­³</p>;
}
```
useRecoilValueã¯å€¤ã®å‚ç…§ã®ã¿ã€useSetRecoilStateã¯æ›´æ–°ã®ã¿ã«ãªã‚Šã¾ã™ã€‚

## éåŒæœŸå‡¦ç†
selectorã§éåŒæœŸã§å€¤ã‚’å–å¾—ã™ã‚‹ä¾‹ãŒå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ã‚Šã¾ã—ãŸã€‚
ç°¡å˜ã«å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
https://recoiljs.org/docs/api-reference/core/selector/#example-asynchronous


```tsx
import { selector, useRecoilValue } from 'recoil';

// selectorã§éåŒæœŸã§å€¤ã‚’å–å¾—
const myQuery = selector({
  key: 'MyDBQuery',
  get: async () => {
    const response = await fetch(getMyRequestUrl());
    return response.json();
  },
});

const QueryResults = () => {
  const queryResults = useRecoilValue(myQuery);

  return (
    <div>
      {queryResults.foo}
    </div>
  );
}

const ResultsSection = () => {
  return (
    <React.Suspense fallback={<div>Loading...</div>}>
      <QueryResults />
    </React.Suspense>
  );
}
```

ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸå ´åˆã¯ã€ErrorBoundryã‚’å®šç¾©ã—ã‚¨ãƒ©ãƒ¼ç”¨ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚
https://reactjs.org/docs/error-boundaries.html

## atomFamilyã¨selectorFamily

## useRecoilCallBack
## å‚è€ƒæ–‡çŒ®
https://recoiljs.org/docs/introduction/installation
https://qiita.com/itachi/items/02688096bc5734396e8e


